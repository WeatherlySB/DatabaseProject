<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add New Tank</title>
  <link rel="stylesheet" href="../static/style.css">
    <!-- Other head elements... -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
    
    <!-- Make reminders data available to JavaScript -->
    <script>
        // This passes the reminders data from Python to JavaScript
        var remindersData = {{ reminders_json|safe }};
    </script>
    
    <!-- Include your calendar JavaScript file -->
    <script src="../static/calendar.js" defer></script>
    
    <!-- Calendar CSS (add this to your CSS file or include separately) -->
    <style>
        /* Calendar styles - copy over your existing CSS or include from external file */
        .calendar-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* Add your other calendar styles here */
    </style>
</head>

<body>



  <link href="https://fonts.googleapis.com/css?family=DM+Sans:400,500,700&display=swap" rel="stylesheet">
  <div class="task-manager">
    <div class="left-bar">
      <div class="upper-part">
        <div class="actions">

          
        </div> <!-- actions -->
      </div> <!-- upper-part -->
    </div> <!-- left-bar -->


    <div class="page-content">
      <div class="header">Today Tasks</div>

      <div class="content-categories">
        
        <div class="label-wrapper">
            <input class="nav-item" name="nav" type="radio" id="opt-2" {% if active_tab == 'opt-2' %}checked{% endif %}
                   onclick="updateTab('opt-2')">
            <label class="category" for="opt-2">Reminders</label>
        </div>
        <div class="label-wrapper">
            <input class="nav-item" name="nav" type="radio" id="opt-3" {% if active_tab == 'opt-3' %}checked{% endif %}
                   onclick="updateTab('opt-3')">
            <label class="category" for="opt-3">Species</label>
        </div>
        <div class="label-wrapper">
            <input class="nav-item" name="nav" type="radio" id="opt-4" {% if active_tab == 'opt-4' %}checked{% endif %}
                   onclick="updateTab('opt-4')">
            <label class="category" for="opt-4">Tanks</label>
        </div>
    </div> <!-- content categories -->

      
      <div class="tasks-wrapper">

        <div class="task" data-category="my-reminder">
         
          <div class="label-reminder">
            <button class="dropdown-button" onclick="toggleReminderForm()">➕ Create a Reminder</button>
          </div>
          
          <div id="reminderForm" class="dropdown-content dropdown-hidden">
            <form action="/add_reminder" method="POST">
              <label for="title">Title:</label>
              <input title="title_input" type="text" name="title" required>
          
              <label for="tank_id">Select Tank(s):</label>
              <select id="tank_id" name="tank_ids" multiple required>
                {% for tank in tanks %}
                  <option value="{{ tank.tank_id }}">{{ tank.tank_name }}</option>
                {% endfor %}
              </select>
          
              <label for="description">Description:</label>
              <textarea title="desc_input" name="description"></textarea>
          
              <label for="due_date">Due Date:</label>
              <input title="datetime_input" type="datetime-local" name="due_date" required>
          
              <label for="start_date">Start Date:</label>
              <input title="start_date_input" type="datetime-local" name="start_date">
          
              <label for="recurrence_type">Recurrence Type:</label>
              <select title="reminder_type_input" name="recurrence_type" onchange="handleRecurrenceChange(this.value)">
                <option value="none" selected>None</option>
                <option value="weekly">Weekly</option>
                <option value="monthly">Monthly</option>
              </select>              
          
              <div id="weekly_options" class="recurrence-options hidden">
                <label>Weekly Recurrence Days:</label><br>
                <input title="recurr_mon" type="checkbox" name="recurrence_interval[]" value="Mon"> Mon
                <input title="recurr_tue" type="checkbox" name="recurrence_interval[]" value="Tue"> Tue
                <input title="recurr_wed" type="checkbox" name="recurrence_interval[]" value="Wed"> Wed
                <input title="recurr_thur" type="checkbox" name="recurrence_interval[]" value="Thu"> Thu
                <input title="recurr_fri" type="checkbox" name="recurrence_interval[]" value="Fri"> Fri
                <input title="recurr_sat" type="checkbox" name="recurrence_interval[]" value="Sat"> Sat
                <input title="recurr_sun" type="checkbox" name="recurrence_interval[]" value="Sun"> Sun
              </div>
          
              <div id="monthly_options" class="recurrence-options hidden">
                <label for="recurrence_monthly">Day of month:</label>
                <input title="recurr_monthly" type="number" name="recurrence_monthly" min="1" max="31">
              </div>
          
              <label for="category">Category:</label>
              <select title="category_input" name="category">
                <option value="cleaning">Cleaning</option>
                <option value="feeding">Feeding</option>
                <option value="water_change">Water Change</option>
                <option value="medication">Medication</option>
                <option value="testing">Testing</option>
                <option value="maintenance">Maintenance</option>
                <option value="other">Other</option>
              </select>
          
              <label for="status">Status:</label>
              <select title="status_input" name="status">
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="snoozed">Snoozed</option>
                <option value="cancelled">Cancelled</option>
              </select>
          
              <button type="submit">Create Reminder</button>
            </form>
          </div>
       
          <div class="calendar-container">
            <div id="calendar"></div>
          </div>
         
        
          
        </div> <!-- my-reminders -->
        <!-- End of reminders task -->


        <!-- Species task section ///  Species task section ///  Species task section ///  Species task section  -->
        <!-- Start of Fish search function-->
        <div class="task" data-category="species">
          <div class="search-wrapper">
            <form method="POST" class="search-box">
              <input type="text" name="search" placeholder="Search Genus, Species, or FBname">
              <div class="button-group">
                <button type="submit" name="action" value="search" class="search-btn">Search</button>
                <button type="submit" name="action" value="clear" class="clear-btn">Clear</button>
              </div>
            </form>
        
            {% if searched %}
              {% if results %}
                <div class="results">
                  {% for fish in results %}
                    <div class="result">
                      {% if fish['image_url'] %}
                        <div class="fish-image">
                          <img src="{{ fish['image_url'] }}" alt="{{ fish['Genus'] }} {{ fish['Species'] }}">
                        </div>
                      {% endif %}
                      <div class="fish-details">
                        <strong>Genus:</strong> {{ fish['Genus'] }}<br>
                        <strong>Species:</strong> {{ fish['Species'] }}<br>
                        <strong>Name:</strong> {{ fish['FBname'] or 'N/A' }}<br>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="no-results">No results found.</p>
              {% endif %}
            {% endif %}
          </div>
        </div>
         <!-- task species-->


<!-- tanks section-->
<div class="task" data-category="tanks">
  <!-- Toggle Button -->
  <div class="label-tank">
    <button id="toggle-tanks" class="toggle-button">
      <span class="button-icon">+</span> Add a New Tank
    </button>
  </div>
  <!-- Tank Form Content -->
  <div id="tanks-content">
    <form action="/add_tank" method="post" class="tank-form">
      <div class="form-header">
        <h2>New Tank Information</h2>
        <p>Enter the details for your aquarium setup below</p>
      </div>
      
      <div class="form-grid">
        <div class="form-group">
          <label for="tank_name">Tank Name</label>
          <input title="tank_input" type="text" id="tank_name" name="tank_name" placeholder="My Reef Tank" required>
        </div>
        
        <div class="form-group">
          <label for="water_type">Water Type</label>
          <select title="water_input" id="water_type" name="water_type" required>
            <option value="" disabled selected>Select water type</option>
            <option value="0">Freshwater</option>
            <option value="1">Saltwater</option>
            <option value="2">Brackish</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="water_amount_litre">Current Water (litres)</label>
          <input title="water_amount_input" type="number" id="water_amount_litre" name="water_amount_litre" placeholder="75" required>
        </div>
        
        <div class="form-group">
          <label for="tank_volume">Tank Volume (litres)</label>
          <input title="tank_volume_input" type="number" id="tank_volume" name="tank_volume" placeholder="100" required>
        </div>
        
        <div class="form-group">
          <label for="filter_type">Filter Type</label>
          <input title="filter_type_input" type="text" id="filter_type" name="filter_type" placeholder="Canister filter" required>
        </div>
        
        <div class="form-group">
          <label for="heater">Heater Included?</label>
          <select title="heater_input" id="heater" name="heater" required>
            <option value="" disabled selected>Select option</option>
            <option value="1">Yes</option>
            <option value="0">No</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="temp_c">Temperature (°C)</label>
          <input title="temperature_input" type="number" id="temp_c" name="temp_c" placeholder="24" required>
        </div>
        
        <div class="form-group">
          <label for="last_cleaned">Last Cleaned</label>
          <input title="last_cleaned_input" type="datetime-local" id="last_cleaned" name="last_cleaned" required>
        </div>
        
        <div class="form-group">
          <label for="cleaning_frequency_days">Cleaning Frequency (days)</label>
          <input title="cleaning_frequency_input" type="number" id="cleaning_frequency_days" name="cleaning_frequency_days" placeholder="14" required>
        </div>
        
        <div class="form-group">
          <label for="lighting">Lighting</label>
          <input title="lighting_input" type="text" id="lighting" name="lighting" placeholder="LED Full Spectrum" required>
        </div>
        
        <div class="form-group">
          <label for="location">Location</label>
          <input title="location_input" type="text" id="location" name="location" placeholder="Living Room" required>
        </div>
      </div>
      
      <div class="form-actions">
        <button type="submit" class="submit-button">Save Tank</button>
        <button type="reset" class="reset-button">Clear Form</button>
      </div>
    </form>
  </div>
  <!-- tanks-content-->

  <!-- Link on one line -->
  <div class="tanks-info">
   <hr>
    <div id="sub-table-desc">
      <h2>
       Add Notes to Table
      </h2>

    </div> <!-- sub-table-desc-->

    <!-- Create mass table or detailed table section, buttons-->
    <div class="wrapper">
      <div class="buttonWrapper">
        <button class="tab-button pill" data-id="mass-sect">Mass</button>
        <button class="tab-button pill" data-id="detail-sect">Detailed</button>
      </div> <!-- buttonWrapper  mass and detail buttons-->
    
      <div class="contentWrapper" id="content-wrapper">
        <button class="close-content" id="close-content-btn" title="Close"></button>
    
        <div class="content" id="mass-sect">
          <div class="search-box-mass">
            <form method="POST">
              <input type="text" name="search" placeholder="Search Genus, Species, or FBname">
              <button type="submit" name="action" value="search">Search</button>
              <button type="submit" name="action" value="clear">Clear</button>
            </form>
          </div>
          <div id="search-results-container">
            {% if searched %}
            {% if results %}
            <div class="result-mass">
              {% for fish in results %}
              <div class="result-content" data-speccode="{{ fish['SpecCode'] }}" data-genus="{{ fish['Genus'] }}"
                data-species="{{ fish['Species'] }}" data-fbname="{{ fish['FBname'] or 'N/A' }}">
                <button class="select-fish">
                  <strong>Genus:</strong> {{ fish['Genus'] }}<br>
                  <strong>Species:</strong> {{ fish['Species'] }}<br>
                  <strong>FBname:</strong> {{ fish['FBname'] or 'N/A' }}<br>
                  <strong>SpecCode:</strong> {{ fish['SpecCode'] }}<br>
                  <strong>SpeciesRefNo:</strong> {{ fish['SpeciesRefNo'] or 'N/A' }}
                </button>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <p>No results found.</p>
            {% endif %}
            {% endif %}
          </div>

          <form id="mass-fish-form" action="/add_mass_fish" method="post">
            <label for="mass_tank_id">Select Tank:</label>
            <select id="mass_tank_id" name="tank_id" required>
              {% for tank in tanks %}
              <option value="{{ tank.tank_id }}">{{ tank.tank_name }}</option>
              {% endfor %}
            </select>
          
            <label for="mass_selected_species">Selected Species:</label>
            <input type="text" id="mass_selected_species" name="selected_species" readonly>
          
            <label for="mass_fbname">FBname:</label>
            <input type="text" id="mass_fbname" name="fbname" readonly>
          
            <input type="hidden" id="mass_SpecCode" name="SpecCode" required>
          
            <label for="notes_mass">Notes:</label>
            <input type="text" id="notes_mass" name="notes_mass" required>
          
            <label for="mass_quantity">Quantity:</label>
            <input type="number" id="mass_quantity" name="mass_quantity" required>
          
            <label for="mass_avg_age_months">Average Age (Months):</label>
            <input type="number" id="mass_avg_age_months" name="avg_age_months" required>
          
            <button type="submit">Add</button>
          </form>
        </div> <!-- mass-sect -->

        <!-- detail section and search // Detail section  // Detail section-->
        <div class="content" id="detail-sect">
          <div class="search-box-detail">
            <form method="POST">
              <input type="text" name="search" placeholder="Search Genus, Species, or FBname">

              <button type="submit" name="action" value="search">Search</button>
              <button type="submit" name="action" value="clear">Clear</button>
            </form>
          </div>
          <div id="search-results-container">
            {% if searched %}
            {% if results %}
            <div class="result-detail">
              {% for fish in results %}
              <div class="result-content" data-speccode="{{ fish['SpecCode'] }}" data-genus="{{ fish['Genus'] }}"
                data-species="{{ fish['Species'] }}" data-fbname="{{ fish['FBname'] or 'N/A' }}">
                <button class="select-fish-detail" style="all: unset; cursor: pointer; width: 100%;">
                  <strong>Genus:</strong> {{ fish['Genus'] }}<br>
                  <strong>Species:</strong> {{ fish['Species'] }}<br>
                  <strong>FBname:</strong> {{ fish['FBname'] or 'N/A' }}<br>
                  <strong>SpecCode:</strong> {{ fish['SpecCode'] }}<br>
                  <strong>SpeciesRefNo:</strong> {{ fish['SpeciesRefNo'] or 'N/A' }}
                </button>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <p>No results found.</p>
            {% endif %}
            {% endif %}
          </div> <!-- search-results-container -->

          <form id="detail-fish-form" action="/add_detail_fish" method="post">
            <label for="detail_tank_id">Select Tank:</label>
            <select id="detail_tank_id" name="tank_id" required>
              {% for tank in tanks %}
              <option value="{{ tank.tank_id }}">{{ tank.tank_name }}</option>
              {% endfor %}
            </select>
          
            <label for="detail_selected_species">Selected Species:</label>
            <input type="text" id="detail_selected_species" name="selected_species" readonly>
          
            <label for="detail_fbname">FBname:</label>
            <input type="text" id="detail_fbname" name="fbname" readonly>
          
            <input type="hidden" id="detail_SpecCode" name="SpecCode" required>
          
            <label for="notes_detail">Notes:</label>
            <input type="text" id="notes_detail" name="notes_detail" required>
          
            <label for="detail_avg_age_months">Average Age (Months):</label>
            <input type="number" id="detail_avg_age_months" name="avg_age_months" required>
          
            <label for="date_added">Date Added:</label>
            <input type="date" id="date_added" name="date_added" required>
          
            <label for="health_status">Health Status:</label>
            <input type="text" id="health_status" name="health_status" required>
          
            <label for="behavior_notes">Behavior Notes:</label>
            <input type="text" id="behavior_notes" name="behavior_notes">
          
            <label for="fish_name">Fish Name:</label>
            <input type="text" id="fish_name" name="fish_name">
          
            <label for="fish_identifiers">Fish Identifiers:</label>
            <input type="text" id="fish_identifiers" name="fish_identifiers">
          
            <button type="submit">Add</button>
          </form>

        </div> <!-- detail-sect -->

      </div> <!-- contentWrapper -->

    </div> <!-- wrapper --> 
    <!-- Create mass table or detailed table section, buttons-->

    <!-- YOUR TANKS SECTION /// YOUR TANKS SECTION  ///   YOUR TANKS SECTION /// YOUR TANKS SECTION-->
    {% if show_tanks %}
    <div class="container mt-4">
      <hr>
      <div class="card">
        <div class="card-header">
          <h2>Your Tanks</h2>
        </div>
        
   
        <div class="modal fade behind-background" id="editTankModal" tabindex="-1" aria-labelledby="editTankModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content tank-card">
          <div class="modal-header border-0 p-0">
            <h3 id="editTankModalLabel">Edit Tank</h3>
           
          </div> <!-- modal-header border-0 p-0-->
          <div class="modal-body p-0">
            <form id="editTankForm" method="post">
              <input type="hidden" id="edit_tank_id" name="tank_id">
              
              <ul class="tank-details">
                <li>
                  <strong>Tank Name:</strong>
                  <input type="text" class="form-control" id="edit_tank_name" name="tank_name" required>
                </li>
                <li>
                  <strong>Water Type:</strong>
                  <select class="form-select" id="edit_water_type" name="water_type">
                    <option value="0">Freshwater</option>
                    <option value="1">Saltwater</option>
                    <option value="2">Brackish</option>
                  </select>
                </li>
                <li>
                  <strong>Water Amount (L):</strong>
                  <input type="number" step="0.1" class="form-control" id="edit_water_amount_litre" name="water_amount_litre">
                </li>
                <li>
                  <strong>Tank Volume:</strong>
                  <input type="text" class="form-control" id="edit_tank_volume" name="tank_volume">
                </li>
                <li>
                  <strong>Filter Type:</strong>
                  <input type="text" class="form-control" id="edit_filter_type" name="filter_type">
                </li>
                <li>
                  <strong>Heater:</strong>
                  <input type="text" class="form-control" id="edit_heater" name="heater">
                </li>
                <li>
                  <strong>Temperature (°C):</strong>
                  <input type="number" step="0.1" class="form-control" id="edit_temp_c" name="temp_c">
                </li>
                <li>
                  <strong>Last Cleaned:</strong>
                  <input type="datetime-local" class="form-control" id="edit_last_cleaned" name="last_cleaned">
                </li>
                <li>
                  <strong>Cleaning Frequency (days):</strong>
                  <input type="number" class="form-control" id="edit_cleaning_frequency_days" name="cleaning_frequency_days">
                </li>
                <li>
                  <strong>Lighting:</strong>
                  <input type="text" class="form-control" id="edit_lighting" name="lighting">
                </li>
                <li>
                  <strong>Location:</strong>
                  <input type="text" class="form-control" id="edit_location" name="location">
                </li>
              </ul>
              
              <div class="mt-2">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
              </div>
            </form>
          </div> <!-- modal-body p-0 -->
        </div> <!-- modal-content tank-card -->
      </div> <!-- modal-dialog modal-lg -->
    </div> <!-- modal fade   editTankModal-->
    <!-- edit tank modal  //// modal-->
        <div class="card-body">
          <div class="table-responsive">
            {% for tank in tanks %}
            <div class="tank-card" id="tank-card-{{ tank.tank_id }}">
              <h3>{{ tank.tank_name }}</h3>
              <ul class="tank-details">
                <li><strong>Water Type:</strong> 
                  {% if tank.water_type == 0 %}
                    Freshwater
                  {% elif tank.water_type == 1 %}
                    Saltwater
                  {% elif tank.water_type == 2 %}
                    Brackish
                  {% else %}
                    {{ tank.water_type }}
                  {% endif %}
                </li>
                <li><strong>Water Amount (L):</strong> {{ tank.water_amount_litre }}</li>
                <li><strong>Tank Volume:</strong> {{ tank.tank_volume }}</li>
                <li><strong>Filter Type:</strong> {{ tank.filter_type }}</li>
                <li><strong>Heater:</strong> 
                  {% if tank.heater == 0 %}
                  No
                  {%elif tank.heater == 1%}
                  Yes
                  {% else %}
                    {{ tank.heater }}
                  {% endif %}
                </li>
                <li><strong>Temperature (°C):</strong> {{ tank.temp_c }}</li>
                <li><strong>Last Cleaned:</strong> {{ tank.last_cleaned }}</li>
                <li><strong>Cleaning Frequency (days):</strong> {{ tank.cleaning_frequency_days }}</li>
                <li><strong>Lighting:</strong> {{ tank.lighting }}</li>
                <li><strong>Location:</strong> {{ tank.location }}</li>
              </ul>

              <!-- Dropdown section for additional notes -->
              <label class="dropdown">
                <div class="dd-button">
                  Fish Data
                </div>

                <input type="checkbox" class="dd-input" id="tank-dropdown-{{ tank.tank_id }}">

                <ul class="dd-menu">
                  {% set mass_fish_found = false %}
                  {% set detail_fish_found = false %}

                  <!-- Check for mass_fish data -->
                  {% for mass in mass_fish %}
                  {% if mass.tank_id == tank.tank_id %}
                  {% set mass_fish_found = true %}
                  <li class="fish-data">
                    <strong>Mass Fish Entry:</strong>
                    <ul>
                      <li>Notes: {{ mass.notes_mass }}</li>
                      <li>Quantity: {{ mass.mass_quantity }}</li>
                      <li>Average Age: {{ mass.avg_age_months }} months</li>
                    </ul>
                  </li>
                  {% if not loop.last %}<li class="divider"></li>{% endif %}
                  {% endif %}
                  {% endfor %}

                  <!-- Check for detail_fish data -->
                  {% for detail in detail_fish %}
                  {% if detail.tank_id == tank.tank_id %}
                  {% set detail_fish_found = true %}
                  <li class="fish-data">
                    <strong>{{ detail.fish_name if detail.fish_name else 'Fish Details' }}</strong>
                    <ul>
                  
                      <li>Notes: {{ detail.notes_detail }}</li>
                      <li>Average Age: {{ detail.avg_age_months }} months</li>
                      <li>Date Added: {{ detail.date_added }}</li>
                      <li>Health Status: {{ detail.health_status }}</li>
                      <li>Behavior Notes: {{ detail.behavior_notes }}</li>
                      {% if detail.fish_identifiers %}<li>Identifiers: {{ detail.fish_identifiers }}</li>{% endif %}
                    </ul>
                  </li>
                  {% if not loop.last %}<li class="divider"></li>{% endif %}
                  {% endif %}
                  {% endfor %}

                  {% if not mass_fish_found and not detail_fish_found %}
                  <li>No fish data or additional data available for this tank</li>
                  {% endif %}
                </ul>
              </label>
              <div class="mt-2">
                <button type="button" class="btn btn-primary btn-sm edit-tank-btn" 
                  data-tank-id="{{ tank.tank_id }}">Edit</button>
              
                <!-- delete tank form -->
                <form action="/delete_tank/{{ tank.tank_id }}" method="post" class="delete-form mt-2"
                  onsubmit="return confirm('Are you sure you want to delete this tank, its Fish Data, notes, reminders, and other connected information? ');">
                  <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
              </div>
            </div> <!-- tank-card -->
            {% endfor %}
          </div> <!-- table-responsive -->
        </div> <!-- card-body -->
        
      </div> <!-- card -->
    </div> <!-- container mt-4 -->
    {% endif %}


  </div> <!-- tanks-info -->
</div> <!-- task    tanks-->




      </div> <!-- tasks-wrapper -->

    </div> <!-- page-content -->




    <!-- Reminders section RIGHT SIDE -->
    <div class="right-bar">
      <div class="top-part"></div> <!-- spacing above Reminders section -->
      <div class="header">Reminders</div>
      <div class="right-content">
        {% if reminders %}
          <ul class="reminder-list">
            {% for reminder in reminders %}
              <li class="reminder-item">
                <h3>{{ reminder.title }}</h3>
    
                <div class="reminder-meta">
                  <p><strong>Due:</strong> {{ reminder.due_date }}</p>
                  <p><strong>Category:</strong> {{ reminder.category }}</p>
                  <p>{{ reminder.recurrence_type }}</p>
                </div>
    
                <div class="reminder-description">
                  <p>{{ reminder.description }}</p>
                </div>
    
                <span class="status-badge {{ reminder.status|lower }}">{{ reminder.status }}</span>
    
                <form action="{{ url_for('delete_reminder') }}" method="POST" class="delete-form">
                  <input type="hidden" name="reminder_id" value="{{ reminder.reminder_id }}">
                  <button type="submit" class="delete-btn" title="Delete reminder"></button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="empty-reminders">
            <p>No reminders yet.</p>
          </div>
        {% endif %}
      </div>
    </div>
    




<script>
/**
 * Main entry point - initializes all functionality when DOM is fully loaded
 */
 document.addEventListener('DOMContentLoaded', function() {
  // Initialize all UI functionality
  initializeUI();
  
  // Setup tank toggle functionality
  setupTankToggle();
  
  // Setup modal functionality
  setupModalBehavior();

});

/**
 * Initialize all UI components and event handlers
 */
function initializeUI() {
  // Get active tab from localStorage or default to 'opt-2'
  const activeTab = localStorage.getItem('activeTab') || 'opt-2';
  

  // Set up core functionality
  setupNavFiltering();
  setupTabSwitching();
  setupFishSelection();
  setupEditButtonHandlers();
  
  // Check the appropriate radio button
  const tabRadio = document.getElementById(activeTab);
  if (tabRadio) {
    tabRadio.checked = true;
    
    // Update forms and filter tasks
    updateFormsWithActiveTab(activeTab);
    filterTasks(activeTab);
  }
  
}

/**
 * Function to update the active tab and add it to form submissions
 * @param {string} tabId - The ID of the tab to activate
 */
 function updateTab(tabId) {
  // Update active tab in localStorage for persistence across page loads
  localStorage.setItem('activeTab', tabId);
  
  // Add hidden field to all forms to maintain tab selection
  updateFormsWithActiveTab(tabId);
  
  // Filter tasks based on the selected tab
  filterTasks(tabId);
}

/**
 * Add active tab value to all forms as a hidden input
 * @param {string} tabId - The ID of the active tab
 */
 function updateFormsWithActiveTab(tabId) {
  const forms = document.querySelectorAll('form');
  
  forms.forEach(form => {
    // Remove any existing active_tab hidden field
    const existingField = form.querySelector('input[name="active_tab"]');
    if (existingField) {
      existingField.remove();
    }
    
    // Add new hidden field with current active tab
    const hiddenField = document.createElement('input');
    hiddenField.type = 'hidden';
    hiddenField.name = 'active_tab';
    hiddenField.value = tabId;
    form.appendChild(hiddenField);
  });
}

/**
 * Sets up toggle functionality for the tanks section
 */
function setupTankToggle() {
  const toggleButton = document.getElementById('toggle-tanks');
  const tankContent = document.getElementById('tanks-content');
  
  if (!toggleButton || !tankContent) return;
  
  // Set initial state (hidden)
  tankContent.style.display = 'none';
  
  // Add click event listener to the toggle button
  toggleButton.addEventListener('click', function() {
    // Toggle visibility of the tank form
    if (tankContent.style.display === 'none') {
      tankContent.style.display = 'block';
      toggleButton.querySelector('.button-icon').textContent = '-';
    } else {
      tankContent.style.display = 'none';
      toggleButton.querySelector('.button-icon').textContent = '+';
    }
  });
}

/**
 * Sets up navigation filtering functionality
 */
function setupNavFiltering() {
  const navItems = document.querySelectorAll('.nav-item');
  
  navItems.forEach(item => {
    item.addEventListener('change', function() {
      filterTasks(this.id);
    });
  });
}

/**
 * Filter tasks based on selected category
 * @param {string} optionId - The ID of the selected navigation option
 */
function filterTasks(optionId) {
  const tasks = document.querySelectorAll('.task');
  const upcomingHeader = document.querySelector('.header.upcoming');
  const category = getCategoryFromOption(optionId);
  let foundBeforeUpcoming = false;
  let foundAfterUpcoming = false;
  let passedUpcoming = false;

  tasks.forEach(task => {
    const taskCategories = task.getAttribute('data-category').split(' ');
    const isVisible = taskCategories.includes(category);

    if (upcomingHeader && task.previousElementSibling === upcomingHeader) {
      passedUpcoming = true;
    }

    if (isVisible) {
      if (!passedUpcoming) {
        foundBeforeUpcoming = true;
      } else {
        foundAfterUpcoming = true;
      }
    }

    animateElement(task, isVisible);
  });

  // Handle visibility of associated elements
  handleElementVisibility({
    upcomingHeader,
    foundBeforeUpcoming,
    foundAfterUpcoming,
    hasVisibleTasks: Array.from(tasks).some(task => task.style.display !== 'none'),
    category
  });
}

/**
 * Handle visibility of related UI elements after filtering
 * @param {Object} params - Parameters for visibility handling
 */
function handleElementVisibility({ upcomingHeader, foundBeforeUpcoming, foundAfterUpcoming, hasVisibleTasks, category }) {
  // Handle upcoming header visibility
  if (upcomingHeader) {
    upcomingHeader.style.display = (foundBeforeUpcoming && foundAfterUpcoming) ? 'block' : 'none';
  }
  
  // Handle empty state message
  const emptyMessage = document.querySelector('.empty-message') || createEmptyMessage();
  emptyMessage.style.display = hasVisibleTasks ? 'none' : 'block';

  // Handle tanks image visibility
  const tanksImg = document.getElementById('tanks-img');
  if (tanksImg) {
    tanksImg.style.display = category === 'tanks' ? 'block' : 'none';
  }
}

/**
 * Animate an element's appearance or disappearance
 * @param {Element} element - The element to animate
 * @param {boolean} isVisible - Whether the element should be visible
 */
function animateElement(element, isVisible) {
  if (isVisible) {
    element.style.display = 'flex';
    setTimeout(() => {
      element.style.opacity = '1';
      element.style.transform = 'translateX(0)';
    }, 10);
  } else {
    element.style.opacity = '0';
    element.style.transform = 'translateX(-10px)';
    setTimeout(() => {
      element.style.display = 'none';
    }, 300); // Match transition duration
  }
}

/**
 * Create empty state message for when no tasks are visible
 * @returns {Element} The created message element
 */
function createEmptyMessage() {
  const message = document.createElement('div');
  message.className = 'empty-message';
  message.textContent = 'No tasks found in this category';
  message.style.padding = '30px 0';
  message.style.textAlign = 'center';
  message.style.color = 'var(--secondary-color)';
  message.style.fontStyle = 'italic';
  message.style.display = 'none';

  const tasksWrapper = document.querySelector('.tasks-wrapper');
  if (tasksWrapper) {
    tasksWrapper.appendChild(message);
  }

  return message;
}

/**
 * Get category name from option ID
 * @param {string} optionId - The ID of the option
 * @returns {string} The category name
 */
function getCategoryFromOption(optionId) {
  const categoryMap = {
    'opt-2': 'my-reminder',
    'opt-3': 'species',
    'opt-4': 'tanks'
  };
  
  return categoryMap[optionId];
}

/**
 * Set up tab switching functionality
 */
function setupTabSwitching() {
  const tabs = document.querySelector(".wrapper");
  const tabButton = document.querySelectorAll(".tab-button");
  const contents = document.querySelectorAll(".content");
  const contentWrapper = document.getElementById("content-wrapper");
  const closeButton = document.getElementById("close-content-btn");
  
  if (!tabs || !contentWrapper) return;
  
  tabs.onclick = e => {
    const id = e.target.dataset.id;
    if (id) {
      // Update tab button states
      tabButton.forEach(btn => {
        btn.classList.remove("active");
        btn.classList.remove("pill");
      });
      e.target.classList.add("active");

      // Update content visibility
      contents.forEach(content => {
        content.classList.remove("active");
      });
      const element = document.getElementById(id);
      if (element) {
        element.classList.add("active");
        contentWrapper.classList.remove("closed");
      }
    }
  };
  
  if (closeButton) {
    closeButton.addEventListener("click", function() {
      contentWrapper.classList.add("closed");
      
      // Reset tab button states
      tabButton.forEach(btn => {
        btn.classList.remove("active");
        btn.classList.add("pill");
      });
    });
  }
}

/**
 * Set up fish selection functionality for all sections (mass and detail sections)
 */
function setupFishSelection() {
  setupFishSelectionSection('mass-sect', 'mass');
  setupFishSelectionSection('detail-sect', 'detail');
}

/**
 * Set up fish selection for a specific section
 * @param {string} sectionId - The ID of the section
 * @param {string} prefix - The prefix for form element IDs
 */
function setupFishSelectionSection(sectionId, prefix) {
  const section = document.getElementById(sectionId);
  if (!section) return;
  
  const selectButtons = section.querySelectorAll(`.select-fish${prefix === 'detail' ? '-detail' : ''}`);
  const form = document.getElementById(`${prefix}-fish-form`);
  
  selectButtons.forEach(button => {
    button.addEventListener('click', function() {
      const fishDiv = this.parentElement;
      
      // Extract fish data
      const fishData = {
        specCode: fishDiv.dataset.speccode,
        genus: fishDiv.dataset.genus,
        species: fishDiv.dataset.species,
        fbname: fishDiv.dataset.fbname
      };
      
      // Populate form with fish data
      updateFishFormFields(prefix, fishData);
      
      // Update UI
      updateFishSelectionUI(section, fishDiv, form);
    });
  });
  
  // Form validation
  if (form) {
    form.addEventListener('submit', function(e) {
      if (!document.getElementById(`${prefix}_SpecCode`).value) {
        e.preventDefault();
        alert('Please select a fish from the search results first.');
      }
    });
  }
}

/**
 * Update fish form fields with selected fish data
 * @param {string} prefix - The prefix for form element IDs
 * @param {Object} fishData - The data of the selected fish
 */
function updateFishFormFields(prefix, fishData) {
  document.getElementById(`${prefix}_selected_species`).value = `${fishData.genus} ${fishData.species}`;
  document.getElementById(`${prefix}_fbname`).value = fishData.fbname;
  document.getElementById(`${prefix}_SpecCode`).value = fishData.specCode;
}

/**
 * Update the UI after fish selection
 * @param {Element} section - The section containing fish results
 * @param {Element} selectedFish - The selected fish element
 * @param {Element} form - The form to scroll to
 */
function updateFishSelectionUI(section, selectedFish, form) {
  // Highlight selected fish
  section.querySelectorAll('.result').forEach(div => {
    div.classList.remove('selected');
  });
  selectedFish.classList.add('selected');
  
  // Scroll to form
  if (form) {
    form.scrollIntoView({ behavior: 'smooth' });
  }
}

/**
 * Set up modal behavior for the application
 */
function setupModalBehavior() {
  // Hide the edit modal by default
  const editModal = document.getElementById('editTankModal');
  if (editModal) {
    editModal.classList.add('behind-background');
  }
  
  // Setup modal dismiss to restore tank cards and hide the modal
  setupModalCloseHandlers();
}

/**
 * Set up the modal close handlers
 */
function setupModalCloseHandlers() {
  // Setup handlers for all dismiss buttons
  document.querySelectorAll('[data-bs-dismiss="modal"]').forEach(button => {
    button.addEventListener('click', function() {
      const modal = this.closest('.modal');
      if (modal) {
        // Hide the modal
        modal.classList.add('behind-background');
        
        // Restore the tank card if a tank ID is set
        const tankId = document.getElementById('edit_tank_id').value;
        if (tankId) {
          restoreTankCard(tankId);
        }
      }
    });
  });
  
  // Add event listener for the cancel button to restore tank card and hide modal
  const cancelBtn = document.querySelector('#editTankModal .btn-secondary');
  if (cancelBtn) {
    cancelBtn.addEventListener('click', function() {
      // Hide the modal
      const modal = document.getElementById('editTankModal');
      modal.classList.add('behind-background');
      
      // Restore the tank card
      const tankId = document.getElementById('edit_tank_id').value;
      if (tankId) {
        restoreTankCard(tankId);
      }
    });
  }
  
  // Handle form submission
  const editForm = document.getElementById('editTankForm');
  if (editForm) {
    editForm.addEventListener('submit', function() {
      // You could add additional logic here if needed
      // For example, validation or confirmation
    });
  }
}

/**
 * Set up edit button click handlers
 */
function setupEditButtonHandlers() {
  // Add click handlers to all edit buttons
  document.querySelectorAll('.edit-tank-btn').forEach(button => {
    button.addEventListener('click', function(event) {
      const tankId = this.getAttribute('data-tank-id');
      moveTankBehindBackground(event, this);
      showEditModal(tankId);
    });
  });
}

/**
 * Handle tank card visibility states
 * @param {string} tankId - ID of the tank to toggle
 * @param {boolean} show - Whether to show or hide the tank
 */
function toggleTankCardVisibility(tankId, show) {
  const tankCard = document.getElementById('tank-card-' + tankId);
  if (tankCard) {
    if (show) {
      tankCard.classList.remove('behind-background');
    } else {
      tankCard.classList.add('behind-background');
    }
  }
}

/**
 * Hide tank card behind background and prepare to show the edit modal
 * @param {Event} event - The click event
 * @param {HTMLElement} button - The button element that was clicked
 */
function moveTankBehindBackground(event, button) {
  // Prevent default button behavior
  event.preventDefault();
  
  // Get the tank ID from the button's data attribute
  const tankId = button.getAttribute('data-tank-id');
  
  // Hide the tank card
  toggleTankCardVisibility(tankId, false);
  
  // Set the tank ID in the edit form
  document.getElementById('edit_tank_id').value = tankId;
  
  // Fetch and populate the form with the tank's current data
  fetchTankDataAndPopulateForm(tankId);
}

/**
 * Show the edit modal
 * @param {string} tankId - ID of the tank being edited
 */
function showEditModal(tankId) {
  const editModal = document.getElementById('editTankModal');
  if (editModal) {
    // Store the tank ID on the modal for reference
    editModal.setAttribute('data-tank-id', tankId);
    
    // Show the modal by removing the behind-background class
    editModal.classList.remove('behind-background');
    
    // Use Bootstrap's modal show method if available
    if (typeof bootstrap !== 'undefined') {
      const bsModal = new bootstrap.Modal(editModal);
      bsModal.show();
    } else {
      // Fallback if Bootstrap JS is not available
      editModal.style.display = 'block';
    }
  }
}

/**
 * Restore tank card visibility
 * @param {string} tankId - ID of the tank to restore
 */
function restoreTankCard(tankId) {
  toggleTankCardVisibility(tankId, true);
}

/**
 * Fetch tank data and populate the edit form
 * @param {string} tankId - ID of the tank to edit
 */
function fetchTankDataAndPopulateForm(tankId) {
  // AJAX call to fetch the tank data
  fetch(`/get_tank_data/${tankId}`)
    .then(response => response.json())
    .then(tankData => {
      // Populate form fields with tank data
      document.getElementById('edit_tank_name').value = tankData.tank_name;
      document.getElementById('edit_water_type').value = tankData.water_type;
      document.getElementById('edit_water_amount_litre').value = tankData.water_amount_litre;
      document.getElementById('edit_tank_volume').value = tankData.tank_volume;
      document.getElementById('edit_filter_type').value = tankData.filter_type;
      document.getElementById('edit_heater').value = tankData.heater;
      document.getElementById('edit_temp_c').value = tankData.temp_c;
      document.getElementById('edit_last_cleaned').value = formatDateForInput(tankData.last_cleaned);
      document.getElementById('edit_cleaning_frequency_days').value = tankData.cleaning_frequency_days;
      document.getElementById('edit_lighting').value = tankData.lighting;
      document.getElementById('edit_location').value = tankData.location;
      
      // Update form action
      document.getElementById('editTankForm').action = `/update_tank/${tankId}`;
    })
    .catch(error => {
      console.error('Error fetching tank data:', error);
      alert('Failed to load tank data. Please try again.');
    });
}

/**
 * Format date for datetime-local input field
 * @param {string} dateString - The date string to format
 * @return {string} Formatted date string
 */
function formatDateForInput(dateString) {
  if (!dateString) return '';
  
  // Try to parse the date string
  const date = new Date(dateString);
  if (isNaN(date.getTime())) return dateString; // Return original if invalid
  
  // Format as YYYY-MM-DDThh:mm
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  
  return `${year}-${month}-${day}T${hours}:${minutes}`;
}


function toggleReminderForm() {
  const reminderForm = document.getElementById("reminderForm");
  reminderForm.classList.toggle("dropdown-hidden");
}

function handleRecurrenceChange(type) {
  document.getElementById("weekly_options").classList.add("hidden");
  document.getElementById("monthly_options").classList.add("hidden");

  if (type === "weekly") {
    document.getElementById("weekly_options").classList.remove("hidden");
  } else if (type === "monthly") {
    document.getElementById("monthly_options").classList.remove("hidden");
  }
}

document.querySelector('[name="recurrence_type"]').addEventListener('change', function() {
  const weekly = document.getElementById('weekly_options');
  const monthly = document.getElementById('monthly_options');
  weekly.style.display = 'none';
  monthly.style.display = 'none';

  if (this.value === 'weekly') {
    weekly.style.display = 'block';
  } else if (this.value === 'monthly') {
    monthly.style.display = 'block';
  }
});


</script>


</body>

</html>